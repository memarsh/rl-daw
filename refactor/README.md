Refactored code from cogsci-rl/refactor
